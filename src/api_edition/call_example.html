<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>
<body>

<h2>API调用示例</h2>

<form id="apiForm">
  <label for="url">API URL:</label><br>
  <input type="text" id="url" name="url" value="http://localhost:5000/api"><br>
  <label for="class">类别:</label><br>
  <select id="class" name="class">
    <option value="add">添加</option>
    <option value="search">查询</option>
    <!-- 在这里添加更多的选项 -->
  </select><br>
  <label for="id">书籍ID:</label><br>
  <input type="text" id="id" name="id"><br>
  <input type="submit" value="提交">
</form>

<p id="result"></p>

<footer>
  <p>&copy; 2023 星隅 (xing-yv, shingyu). 版权所有。</p>

</footer>

<script>
  document.getElementById("apiForm").addEventListener("submit", function(event){
   event.preventDefault()

   var url = document.getElementById('url').value;

   var data = {
     class: document.getElementById('class').value,
     id: document.getElementById('id').value
   };

   var requestClass = data.class; // 存储请求中的class字段

   console.log("发送的数据：", data);

   fetch(url, {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json'
     },
     body: JSON.stringify(data)
   })
   .then(response => {
     console.log("收到的响应：", response);
     return response.json();
   })
   .then(data => {
     console.log("解析后的数据：", data);

     var resultText = '';
     if (data.error) {
        resultText = '错误：' + data.error;
      } else if (requestClass == 'add') { // 使用存储的requestClass变量
        resultText = '消息：' + data.message + '<br>' +
                      (data.position ? ('位置：' + data.position + '<br>') : '') +
                      (data.status ? ('状态：' + data.status) : '');
      } else if (requestClass == 'search') { // 使用存储的requestClass变量
        resultText = '存在：' + (data.exists ? '是' : '否') + '<br>' +
                      (data.position ? ('位置：' + data.position + '<br>') : '') +
                      (data.status ? ('状态：' + data.status) : '');
      }


     console.log("显示的结果：", resultText);

     document.getElementById('result').innerHTML = resultText;
   })
   .catch((error) => {
     console.error('Error:', error);
   });
 });

  </script>


</body>
</html>
